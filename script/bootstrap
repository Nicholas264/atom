#!/bin/sh

# exit on subprocess errors
set -o errexit

exit_unless_npm_exists() {
  if ! hash npm 2> /dev/null; then
    echo "ERROR: Atom requires npm"
    exit 1
  fi
}

exit_unless_npm_exists

git submodule --quiet sync
git submodule --quiet update --recursive --init

(cd vendor/apm && npm install --silent .)

npm install --silent vendor/apm
echo ""
./node_modules/.bin/apm install --silent
